## Lab: Using Templates

### Application description
[silver]#In this lab, we're going to deploy a complete backend application, consisting of an REST API backend and a mongo database. The complete application will already be wired together and described as a backend for the map visualization tool, so that once the application is build and deployed, you will be able to see the new map.#

この実習では、REST API バックエンドと mongo データベースから成る完全なバックエンドアプリケーションを展開します。完全なアプリケーションは、すでに一緒に配線され、マップ可視化ツールのバックエンドとして記述されているので、一度アプリケーションが構築され、配備すると、新しいマップを見ることができるようになります。


image::roadshow-app-architecture-mlbparks.png[Application architecture,800,align="center"]

### Background: Templates
[silver]#Running all these individual commands can be tedious and error prone.  Fortunately for you, all of this configuration can be put together into a single *Template* which can then be processed to create a full set of resources. As you saw with MongoDB, a *Template* may define parameters for certain values, such as DB username or password, and they can be automatically generated by OpenShift at processing time.#

これらの個々のコマンドを実行すると、面倒でエラーが発生しやすくなります。 幸いなことに、この構成はすべて1つの *Template* にまとめることができるため、リソースの完全なセットを作成するために処理することができます。MongoDB で見たように、*Template* は DB ユーザ名やパスワードなどの特定の値のパラメータを定義し、処理時に OpenShift によって自動的に生成されることがあります。


[silver]#Administrators can load *Templates* into OpenShift and make them available to all users, even via the web console. Users can create *Templates* and load them into their own *Projects* for other users (with access) to share and use.#

管理者は、web コンソールを使用しても、*Template* を OpenShift に読み込んで、すべてのユーザーが利用できるようにすることができます。ユーザーは、*Template* を作成して、他のユーザー (アクセス) を共有して使用するために、自分の *プロジェクト* にロードします。


[silver]#The great thing about *Templates* is that they can speed up the deployment workflow for application development by providing a "recipe" of sorts that can be deployed with a single command.  Not only that, they can be loaded into OpenShift from an external URL, which will allow you to keep your templates in a version control system. And, even further, they can be stored in a version control system (even in the same repository as the application source code) -- they're just serialized text data!#

*Template* の素晴らしいところは、1つのコマンドで展開できる種類の "レシピ" を提供することで、アプリケーション開発のためのデプロイメントワークフローを高速化できることです。 それだけでなく、彼らは、あなたがバージョン管理システムであなたのテンプレートを保つことができるだろう外部 URL から OpenShift にロードされることができます。さらに、それらはバージョン管理システム (アプリケーションのソースコードと同じリポジトリでも) に格納することができます--彼らは単にテキストデータをシリアライズしています!


[silver]#Let's combine all of the exercises we have performed in the last several labs by using a *Template* that we can instantiate with a single command.  While we could have used templates to deploy everything in the workshop today, remember that it is important for you to understand how to create, deploy, and wire resources together.#

最後のいくつかのラボで実行したすべての演習を、1つのコマンドでインスタンス化できる *Template* を使用して組み合わせてみましょう。 今日のワークショップでは、テンプレートを使用してすべてを展開することもできますが、リソースを作成、配置、およびワイヤリングする方法を理解しておくことが重要です。


#### Exercise: Instantiate a Template

[silver]#The front end application we've been working with this whole time will display as many back end services' data as are created. Adding more stuff with the right *Label* will make more stuff show up on the map.＃

我々はこの全体の時間で作業してきたフロントエンドのアプリケーションは、多くのバックエンドサービスのデータが作成されるように表示されます。右 *Label* でより多くのものを追加すると、より多くのものが地図上に表示されます。


[silver]#Now you will deploy a map of Major League Baseball stadiums in the US by using a template. It is pre-configured to build the back end Java application, and deploy the Mongo database. It also uses a *Hook* to call the `/ws/data/load` endpoint to cause the data to be loaded into the database from a JSON file in the source code repository. Execute the following command:#

ここでは、テンプレートを使用して、米国のメジャーリーグベースボールスタジアムのマップを展開します。バックエンド Java アプリケーションを構築し、Mongo データベースをデプロイするように事前に設定されています。また、*Hook* を使用して `/ws/data/load` エンドポイントを呼び出し、ソースコードリポジトリ内の JSON ファイルからデータベースにデータを読み込むようにします。次のコマンドを実行します。


[source]
----
{% if PARKSMAP_PY %}
$ oc create -f https://raw.githubusercontent.com/openshift-roadshow/mlbparks-py/{{MLBPARKS_VERSION}}/ose3/application-template.json
{% else %}
$ oc create -f https://raw.githubusercontent.com/openshift-roadshow/mlbparks/{{MLBPARKS_VERSION}}/ose3/application-template-{{MW_NAME}}.json
{% endif %}
----

[silver]#What just happened? What did you just `create`? The item that we passed to the `create` command is a *Template*. `create` simply makes the template available in your *Project*. You can see this with the following command:#

何が起きたの？ `create` でしたか?　`create` コマンドに渡された項目は、*Template* です。`create` を使用すると、*プロジェクト* でテンプレートを利用できるようになります。これは次のコマンドで確認できます。


[source]
----
$ oc get template
----

[silver]#You will see output like the following:#

次のような出力が表示されます。

[source]
----
{% if PARKSMAP_PY %}
NAME          DESCRIPTION                                                                      PARAMETERS     OBJECTS
mlbparks-py   Application template MLB Parks backend running on Python/Flask and using mongodb 14 (4 blank)   8
{% else %}
mlbparks      Application template MLBParks backend running on {{MW_TEXT}} and using MongoDB   15 (5 blank)   8
{% endif %}
----

[silver]#Are you ready for the magic command?  Here it is:#

あなたは魔法のコマンドの準備ができていますか? はいどうぞ：


{% if USE_MAVEN %}
[source]
----
oc new-app mlbparks --name=mlbparks -p GIT_REF={{MLBPARKS_VERSION}} -p MAVEN_MIRROR_URL=http://nexus.workshop-infra.svc.cluster.local:8081/content/groups/public
----

{% else %}
[source]
----
{% if PARKSMAP_PY %}
oc new-app mlbparks-py -p APPLICATION_NAME=mlbparks -p GIT_URI=https://github.com/openshift-roadshow/mlbparks-py -p GIT_REF={{MLBPARKS_VERSION}}
{% else %}
oc new-app mlbparks -p APPLICATION_NAME=mlbparks -p GIT_REF={{MLBPARKS_VERSION}}
{% endif %}
----
{% endif %}

[silver]#You will see the following output:#

次の出力が表示されます。

{% if USE_MAVEN %}
[source]
----
--> Deploying template mlbparks

     mlbparks
     ---------
     Application template MLBParks backend running on {{MW_TEXT}} and using MongoDB

     * With parameters:
        * Application Name=mlbparks
        * Application route=
        * Mongodb App=mongodb-mlbparks
        * Git source repository=https://github.com/openshift-roadshow/mlbparks
        * Git branch/tag reference={{MLBPARKS_VERSION}}
        * Maven mirror url=http://nexus.workshop-infra.svc.cluster.local:8081/content/groups/public
        * Database name=mongodb
        * MONGODB_NOPREALLOC=
        * MONGODB_SMALLFILES=
        * MONGODB_QUIET=
        * Database user name=userGhR # generated
        * Database user password=KhnHKCQI # generated
        * Database admin password=UyUV6ReU # generated
        * GitHub Trigger=dAOuD7s4 # generated
        * Generic Trigger=tWSkmNLn # generated

--> Creating resources ...
    configmap "mlbparks" created
    service "mongodb-mlbparks" created
    deploymentconfig "mongodb-mlbparks" created
    imagestream "mlbparks" created
    buildconfig "mlbparks" created
    deploymentconfig "mlbparks" created
    service "mlbparks" created
    route "mlbparks" created
--> Success
    Build scheduled, use 'oc logs -f bc/mlbparks' to track its progress.
    Run 'oc status' to view your app.
----
{% else %}
{% if PARKSMAP_PY %}
[source]
----
--> Deploying template "{{USER_NAME}}/mlbparks-py" to project {{USER_NAME}}

     mlbparks-py
     ---------
     Application template MLB Parks backend running on Python/Flask and using mongodb

     * With parameters:
        * Application Name=mlbparks
        * Application route=
        * Mongodb App=mongodb-mlbparks
        * Git source repository=https://github.com/openshift-roadshow/mlbparks-py
        * Git branch/tag reference=1.0.0
        * Database name=mongodb
        * MONGODB_NOPREALLOC=
        * MONGODB_SMALLFILES=
        * MONGODB_QUIET=
        * Database user name=userxmt # generated
        * Database user password=lk8hYPOe # generated
        * Database admin password=uuvr7vRG # generated
        * GitHub Trigger=hbJ8Fdw7 # generated
        * Generic Trigger=ho4s1c6f # generated

--> Creating resources ...
    configmap "mlbparks" created
    service "mongodb-mlbparks" created
    deploymentconfig "mongodb-mlbparks" created
    imagestream "mlbparks" created
    buildconfig "mlbparks" created
    deploymentconfig "mlbparks" created
    service "mlbparks" created
    route "mlbparks" created
--> Success
    Build scheduled, use 'oc logs -f bc/mlbparks' to track its progress.
    Run 'oc status' to view your app.
----
{% else %}
[source]
----
--> Deploying template mlbparks

     mlbparks
     ---------
     Application template MLBParks backend running on {{MW_TEXT}} and using MongoDB

     * With parameters:
        * Application Name=mlbparks
        * Application route=
        * Mongodb App=mongodb-mlbparks
        * Git source repository=https://github.com/openshift-roadshow/mlbparks
        * Git branch/tag reference={{MLBPARKS_VERSION}}
        * Database name=mongodb
        * MONGODB_NOPREALLOC=
        * MONGODB_SMALLFILES=
        * MONGODB_QUIET=
        * Database user name=userGhR # generated
        * Database user password=KhnHKCQI # generated
        * Database admin password=UyUV6ReU # generated
        * GitHub Trigger=dAOuD7s4 # generated
        * Generic Trigger=tWSkmNLn # generated

--> Creating resources ...
    configmap "mlbparks" created
    service "mongodb-mlbparks" created
    deploymentconfig "mongodb-mlbparks" created
    imagestream "mlbparks" created
    buildconfig "mlbparks" created
    deploymentconfig "mlbparks" created
    service "mlbparks" created
    route "mlbparks" created
--> Success
    Build scheduled, use 'oc logs -f bc/mlbparks' to track its progress.
    Run 'oc status' to view your app.
----
{% endif %}
{% endif %}

[silver]#OpenShift will now:#

* [silver]#Configure and start a build#
{% if USE_MAVEN %}
** [silver]#Using the supplied Maven mirror URL#
{% endif %}
** [silver]#From the supplied source code repository#
* [silver]#Configure and deploy MongoDB#
** [silver]#Using auto-generated user, password, and database name#
* [silver]#Configure environment variables for the app to connect to the DB#
* [silver]#Create the correct services#
* [silver]#Label the app service with `type=parksmap-backend`#
[silver]#All with one command!＃

OpenShift は今:

* 構成し、ビルドを開始
{% if USE_MAVEN %}
** 付属の Maven ミラー URL を使用する
{% endif %}
** 提供されたソースコードリポジトリから
* MongoDB の構成と展開
** 自動生成されたユーザー、パスワード、およびデータベース名を使用する
* データベースに接続するためのアプリケーションの環境変数を設定します。
* 正しいサービスを作成する
* ラベルアプリサービス`type=parksmap-backend`

すべて1つのコマンドで!

[silver]#When the build is complete, visit the parks map. Does it work? Think about how this could be used in your environment.  For example, a template could define a large set of resources that make up a "reference application", complete with several app servers, databases, and more.  You could deploy the entire set of resources with one command, and then hack on them to develop new features, microservices, fix bugs, and more.#

ビルドが完了したら、公園マップを参照してください。それは動作しますか?これが環境でどのように使用されるかを考えてください。 たとえば、テンプレートでは、複数のアプリケーションサーバー、データベースなどを含む、"参照アプリケーション" を構成するリソースの大規模なセットを定義できます。 1つのコマンドを使用してリソースのセット全体を展開し、新しい機能、サービス、バグの修正などを開発するためにそれらをハックすることができます。


[silver]#As a final exercise, look at the template that was used to create the resources for our *mlbparks* application.#

最後の練習として、私たちの *mlbparks* アプリケーションのリソースを作成するために使用されたテンプレートを見てください。

[source]
----
{% if PARKSMAP_PY %}
$ oc get template mlbparks-py -o yaml
{% else %}
$ oc get template mlbparks -o yaml
{% endif %}
----
