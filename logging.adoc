## Lab: Exploring OpenShift's Logging Capabilities

[silver]#OpenShift provides some convenient mechanisms for viewing application logs.First and foremost is the ability to examine a *Pod*'s logs directly from the web console or via the command line.#


OpenShift は、アプリケーション ログを表示するためのいくつかの便利なメカニズムを提供します。
まずは *Pod* のログを直接Webコンソールやコマンドラインから確認する方法があります。


### Background: Container Logs
[silver]#OpenShift is constructed in such a way that it expects containers to log all information to `STDOUT`.  In this way, both regular and error information is captured via standardized Docker mechanisms.  When exploring the *Pod*'s logs directly, you are essentially going through the Docker daemon to access the container's logs, through OpenShift's API. Neat!#

OpenShift は、コンテナがすべての情報を `STDOUT` に記録することを期待するような方法で構築されています。 この方法では、標準の docker メカニズムを介して、正規およびエラー情報の両方がキャプチャされます。 *Pod* のログを直接調べる場合、基本的には docker デーモンを経由して、OpenShift の API を通じてコンテナのログにアクセスします。きちんと!


[NOTE]
====
[silver]#In some cases, applications may not have been designed to send all of their information to `STDOUT` and `STDERR`. In many cases, multiple local log files are used. While OpenShift cannot parse any information from these files, nothing prevents them from being created, either. In other cases, log information is sent to some external system using. Here, too, OpenShift does not prohibit these behaviors. If you have an application that does not log to `STDOUT`, either because it already sends log information to some "external" system or because it writes various log information to various files, fear not.#

場合によっては、アプリケーションがすべての情報を `STDOUT` および `STDERR` に送信するように設計されていない場合があります。多くの場合、複数のローカルログファイルが使用されます。OpenShift はこれらのファイルからの情報を解析することはできませんが、いずれも作成されません。それ以外の場合は、ログ情報を使用していくつかの外部システムに送信されます。ここでも、OpenShift はこれらの動作を禁止していません。 `STDOUT` にログ出力していないアプリケーションがある場合は、既にログ情報を「外部」システムに送信しているか、さまざまなファイルにさまざまなログ情報を書き込むので、恐れることはありません。
====



#### Exercise: Examining Logs

[silver]#Since we already deployed our application, we can take some time to examine its
logs. In the web console, find your way back to the *Pod* details page (Applications -> Pods -> specific pod) and then click on the "Logs" tab. You should see a nice view of the *Pod*'s logs:#

既にアプリケーションを展開しているため、ログの確認に時間がかかることがあります。web コンソールで、*Pod* 詳細ページ (Applications -> Pods -> suecific pod) に戻る方法を見つけて、"Logs"タブをクリックします。あなたは、*Pod* のログの素敵なビューが表示されます:

image::parksmap-console-logs.png[Application Logs]

[silver]#It appears there are some errors in the log, and that's OK. We'll remedy those in a little bit.#

これは、ログにいくつかのエラーが表示されます、それは OK です。少しずつでも改善していきます。

[silver]#You also have the option of viewing logs from the command line. Get the name of your *Pod*:#

また、コマンドラインからログを表示するオプションもあります。*Pod* の名前を取得します。


[source]
----
$ oc get pods
NAME               READY     STATUS    RESTARTS   AGE
parksmap-1-hx0kv   1/1       Running   0          5h
----

[silver]#And then use the `logs` command to view this *Pod*'s logs:#

そして、この *Pod* のログを表示するには、`log` コマンドを使用します:

[source]
----
$ oc logs parksmap-1-hx0kv
----

[silver]#You will see all of the application logs scroll on your screen:#

あなたは、すべてのアプリケーション・ログがあなたのスクリーンでスクロールするのを見るでしょう。

[source]
----
15:34:25.844 [main] DEBUG io.fabric8.kubernetes.client.Config - Trying to configure client from Kubernetes config...
15:34:25.937 [main] DEBUG io.fabric8.kubernetes.client.Config - Did not find Kubernetes config at: [/.kube/config]. Ignoring.
15:34:25.937 [main] DEBUG io.fabric8.kubernetes.client.Config - Trying to configure client from service account...
15:34:25.938 [main] DEBUG io.fabric8.kubernetes.client.Config - Found service account ca cert at: [/var/run/secrets/kubernetes.io/serviceaccount/ca.crt].
15:34:25.960 [main] DEBUG io.fabric8.kubernetes.client.Config - Found service account token at: [/var/run/secrets/kubernetes.io/serviceaccount/token].
15:34:25.961 [main] DEBUG io.fabric8.kubernetes.client.Config - Trying to configure client namespace from Kubernetes service account namespace path...
15:34:25.962 [main] DEBUG io.fabric8.kubernetes.client.Config - Found service account namespace at: [/var/run/secrets/kubernetes.io/serviceaccount/namespace].
....
----

#### Exercise: Aggregated Pod Logs

[silver]#When your application consists of only one *Pod* and it never fails, restarts, or has other issues, these ways to view logs may not be so bad. However in a scaled-out application where *Pods* may have restarted, been scaled up or down, or if you just want to get historical information, these mechanisms may be insufficient.#

アプリケーションが1つの *Pod* で構成されていて、失敗、再起動、またはその他の問題が発生しない場合、ログを表示するこれらの方法はあまり悪くない可能性があります。
ただし、スケールアウトされたアプリケーションでは、*Pod* が再起動したり、スケールアップまたはダウンしたり、履歴情報を取得したい場合には、これらのメカニズムが不十分な場合があります。

[silver]#Fortunately, OpenShift provides an optional system for log aggregation that uses Fluentd, Elasticsearch, and Kibana (EFK).#

幸いなことに、OpenShift は、Fluentd、Elasticsearch、Kibana (EFK) を使用して、ログの集計オプションのシステムを提供します。

[silver]#In the OpenShift web console on the *Pod*'s logs page, at the right you will see a "View Archive" link. Go ahead and click it. You will need to accept the SSL certificate.#

OpenShift web コンソールの *Pod* のログページの右側に、"View Archive"リンクが表示されます。それをクリックします。SSL 証明書を受け入れる必要があります。

[silver]#Clicking this link takes you to the Kibana web interface. This interface is secured with OpenShift's role-based access controls, so you can only see logs for projects that you have access to.#

このリンクをクリックすると、Kibana のweb インターフェイスが表示されます。このインターフェイスは、OpenShift のロールベースのアクセス制御で保護されているため、アクセス可能なプロジェクトのログのみを表示できます。


image::kibana-parksmap.png[Kibana Interface]

[silver]#The "View Archive" link that you clicked takes you to a default view with a specific search term pre-populated. Kibana will only show you logs where the pod name is `parksmap-1-hx0kv` and in the *Project* (namespace) {{EXPLORE_PROJECT_NAME}}{{USER_SUFFIX}}.#
"View Archive" リンクをクリックすると、特定の検索用語があらかじめ設定された既定のビューに表示されます。Kibanaはポッド名が `parksmap-1-hx0kv` と *Project* (namespace) {{EXPLORE_PROJECT_NAME}}{{USER_SUFFIX}} である場合にのみログを表示します。


[source]
----
kubernetes.pod_name:"parksmap-1-hx0kv" AND kubernetes.namespace_name:"{{EXPLORE_PROJECT_NAME}}{{USER_SUFFIX}}"
----

[silver]#If you want to see all the historical logs for this *Project*, simply remove the pod name reference and click the magnifying glass.#

この *Project* のすべての履歴ログを表示したい場合は、Pod名参照を削除して虫眼鏡をクリックします。

[source,role=copypaste]
----
kubernetes.namespace_name:"{{EXPLORE_PROJECT_NAME}}{{USER_SUFFIX}}"
----

[silver]#If you click the "x" in the column for the container name, and, in the left bar, click "add" for `kubernetes.pod_name`, you'll then see your old *Pod*'s logs, too. Remember, we scaled them down before coming here, so you can see how the log system is keeping a historical record.#

コンテナ名の列にある "x" をクリックし、左側のバーで「kubernetes. pod _name」をクリックすると、古い *Pod* のログも表示されます。我々はここに来る前に、それらをスケールダウンしたので、ログシステムが履歴記録を保持している方法を見ることができます。

image::kibana-parksmap-headers.png[Kibana Interface]

[silver]#Try the following search string:#

次の検索文字列を試してください。

[source,role=copypaste]
----
kubernetes.namespace_name:"{{EXPLORE_PROJECT_NAME}}{{USER_SUFFIX}}" AND message:"Failure executing"
----

[silver]#Service account? What's that?#

サービス アカウントですか。あれは、何ですか。
